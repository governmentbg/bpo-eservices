<?xml version='1.0' encoding='UTF-8'?>
<smooks-resource-list xmlns="http://www.milyn.org/xsd/smooks-1.1.xsd"
                      xmlns:jb="http://www.milyn.org/xsd/smooks/javabean-1.2.xsd"
                      xmlns:g="http://www.milyn.org/xsd/smooks/groovy-1.1.xsd">
                      

    <jb:bean beanId="representative" class="eu.ohim.sp.external.domain.person.Representative" createOnElement="//Representative">

       <!--<jb:value data="//Representative/RepresentativeIdentifier" property="personNumber"/>  -->
        <jb:value data="//Representative/RepresentativeIncorporationCountryCode" property="incorporationCountry"/>
        <jb:value data="//Representative/RepresentativeIncorporationState" property="incorporationState"/>
        <jb:value data="//Representative/RepresentativeLegalEntity" property="legalForm"/>
        <jb:value data="//Representative/RepresentativeNationalityCode" property="nationality"/>
       
        <jb:value data="//Representative/RepresentativeKindCode" decoder="SPEnum" property="representativeKind" default="eu.ohim.sp.external.domain.person.RepresentativeKind.OTHER">
            <jb:decodeParam name="enumType">eu.ohim.sp.external.domain.person.RepresentativeKind</jb:decodeParam>
            <jb:decodeParam name="National Professional Practitioner">OTHER</jb:decodeParam>
            <jb:decodeParam name="Professional Representative">OTHER</jb:decodeParam>
            <jb:decodeParam name="Lawyer">LAWYER</jb:decodeParam>
            <jb:decodeParam name="Partnership of Professional Representatives">ASSOCIATION</jb:decodeParam>
            <jb:decodeParam name="Company of Professional Representatives">OTHER</jb:decodeParam>
            <jb:decodeParam name="Partnership of Lawyers">LAWYER_ASSOCIATION</jb:decodeParam>
            <jb:decodeParam name="Company of Lawyers">LAWYER_COMPANY</jb:decodeParam>
            <jb:decodeParam name="One-time or Temporary Agent">TEMPORARY_REPRESENTATIVE</jb:decodeParam>
            <jb:decodeParam name="Employee">EMPLOYEE</jb:decodeParam>
            <jb:decodeParam name="Employee with Economic Connections">EMPLOYEE_WITH_ECONOMIC_CONNECTIONS</jb:decodeParam>
            <jb:decodeParam name="Other">OTHER</jb:decodeParam>
            <jb:decodeParam name="Intellectual Property Representative">INTELLECTUAL_PROPERTY_REPRESENTATIVE</jb:decodeParam>
            <jb:decodeParam name="Undefined">UNDEFINED</jb:decodeParam>
        </jb:value>

        <jb:value data="//Representative/RepresentativeLegalEntity" decoder="SPEnum" property="kind" default="eu.ohim.sp.external.domain.person.PersonKind.NATURAL_PERSON">
            <jb:decodeParam name="enumType">eu.ohim.sp.external.domain.person.PersonKind</jb:decodeParam>
            <jb:decodeParam name="Physical">NATURAL_PERSON</jb:decodeParam>
            <jb:decodeParam name="Legal Entity">LEGAL_ENTITY</jb:decodeParam>
        </jb:value>

        <jb:value data="//Representative/@operationCode" decoder="SPEnum" property="operationCode">
            <jb:decodeParam name="enumType">eu.ohim.sp.external.domain.person.OperationCodeType</jb:decodeParam>
            <jb:decodeParam name="Insert">INSERT</jb:decodeParam>
            <jb:decodeParam name="Delete">DELETE</jb:decodeParam>
        </jb:value>

        <jb:wiring beanIdRef="representativeAddresses" property="addresses"/>
         <jb:wiring beanIdRef="representativeName" property="name"/>
         <jb:wiring beanIdRef="representativePhones" property="phones"/>
         <jb:wiring beanIdRef="representativeEmails" property="emails"/>
         <jb:wiring beanIdRef="representativeIdentifiers" property="identifiers"/>
      </jb:bean>

    <jb:bean beanId="representativeIdentifiers" class="java.util.ArrayList" createOnElement="//TransactionData/RepresentativeDetails/Representative">
        <jb:wiring beanIdRef="representativeId"/>
    </jb:bean>

    <jb:bean beanId="representativeId" class="eu.ohim.sp.external.domain.person.PersonIdentifier" createOnElement="//TransactionData/RepresentativeDetails/Representative/RepresentativeIdentifier">
        <jb:value data="//TransactionData/RepresentativeDetails/Representative/RepresentativeIdentifier" property="value"/>
        <jb:value data="//TransactionData/RepresentativeDetails/Representative/RepresentativeIdentifier/@identifierKindCode" property="identifierKindCode"/>
    </jb:bean>


    <jb:bean beanId="representativeFreeFormatCity" class="eu.ohim.sp.integration.domain.smooks.FreeFormatString" 
    	createOnElement="//Representative/RepresentativeDomicileLocality">
        <jb:value data="//Representative/RepresentativeDomicileLocality" property="value"/>
    </jb:bean>

    <jb:bean beanId="representativeAddresses" class="java.util.ArrayList" createOnElement="//Representative/RepresentativeAddressBook/FormattedNameAddress/Address">
        <jb:wiring beanIdRef="representativeAddress"/>
    </jb:bean>

    <jb:bean beanId="representativeAddress" class="eu.ohim.sp.external.domain.contact.Address" 
    		createOnElement="//Representative/RepresentativeAddressBook/FormattedNameAddress/Address">
        <jb:expression property="city">representativeFreeFormatCity!=null?representativeFreeFormatCity.getValue():representativeAddress.city</jb:expression> 
        <jb:value data="//Representative/RepresentativeAddressBook/FormattedNameAddress/Address/FormattedAddress/AddressCity" property="city"/>
        <jb:value data="//Representative/RepresentativeAddressBook/FormattedNameAddress/Address/AddressCountryCode" property="country"/>
        <jb:value data="//Representative/RepresentativeAddressBook/FormattedNameAddress/Address/FormattedAddress/AddressPostcode" property="postCode"/>
        <jb:value data="//Representative/RepresentativeAddressBook/FormattedNameAddress/Address/FormattedAddress/AddressState" property="state"/>
        <jb:value data="//Representative/RepresentativeAddressBook/FormattedNameAddress/Address/FormattedAddress/AddressStreet" property="street"/>
    </jb:bean>
    
    
    <jb:bean beanId="representativePhones" class="java.util.ArrayList" createOnElement="//Representative/RepresentativeAddressBook/ContactInformationDetails">
        <jb:wiring beanIdRef="representativePhone"/>
    </jb:bean>
      
    <jb:bean beanId="representativeEmails" class="java.util.ArrayList" createOnElement="//Representative/RepresentativeAddressBook/ContactInformationDetails">
        <jb:wiring beanIdRef="representativeEmail"/>
    </jb:bean>
    
   
    <jb:bean beanId="representativePhone" class="eu.ohim.sp.external.domain.contact.Phone" createOnElement="//Representative/RepresentativeAddressBook/ContactInformationDetails/Phone">
        <jb:value data="//Representative/RepresentativeAddressBook/ContactInformationDetails/Phone" property="number"/>
       
        <jb:value data="//Representative/RepresentativeAddressBook/ContactInformationDetails/Phone/@phoneKind" decoder="SPEnum" property="phoneKind" default="eu.ohim.sp.external.domain.contact.PhoneKind.MOBILE_PHONE">
            <jb:decodeParam name="enumType">eu.ohim.sp.external.domain.contact.PhoneKind</jb:decodeParam>
            <jb:decodeParam name="defaultValue">OTHER</jb:decodeParam>
            <jb:decodeParam name="Fixed">FIXED</jb:decodeParam>
            <jb:decodeParam name="Mobile Phone">MOBILE_PHONE</jb:decodeParam>
            <jb:decodeParam name="Fax">FAX</jb:decodeParam>
            <jb:decodeParam name="Other">OTHER</jb:decodeParam>
            <jb:decodeParam name="Undefined">OTHER</jb:decodeParam>
        </jb:value>
    </jb:bean>
           
     <jb:bean beanId="representativeEmail" class="eu.ohim.sp.external.domain.contact.Email" createOnElement="//Representative/RepresentativeAddressBook/ContactInformationDetails/Email">
        <jb:value data="//Representative/RepresentativeAddressBook/ContactInformationDetails/Email" property="emailAddress"/>
    </jb:bean>
    
    <jb:bean beanId="representativeName" class="eu.ohim.sp.external.domain.person.PersonName" createOnElement="//Representative/RepresentativeAddressBook/FormattedNameAddress/Name">
        <jb:value data="//Representative/RepresentativeAddressBook/FormattedNameAddress/Name/FormattedName/FirstName" property="firstName"/>
        <jb:value data="//Representative/RepresentativeAddressBook/FormattedNameAddress/Name/FormattedName/LastName" property="lastName"/>
        <jb:value data="//Representative/RepresentativeAddressBook/FormattedNameAddress/Name/FormattedName/MiddleName" property="middleName"/>
        <jb:value data="//Representative/RepresentativeAddressBook/FormattedNameAddress/Name/FormattedName/OrganizationName" property="organizationName"/>
    </jb:bean>

    <jb:bean beanId="representativeName" class="eu.ohim.sp.external.domain.person.PersonName" createOnElement="//Representative/RepresentativeAddressBook/FormattedNameAddress/Name/FreeFormatName">
        <jb:value data="//Representative/RepresentativeAddressBook/FormattedNameAddress/Name/FreeFormatName/FreeFormatNameDetails/FreeFormatNameLine" property="lastName"/>
    </jb:bean>

    <!--
      Set the company name accordingly
   -->
    <g:groovy executeOnElement="//Representative/RepresentativeAddressBook/FormattedNameAddress/Name/FormattedName/LastName">
        <g:script>
            <!--
                def rep = getBean('representative');
                if(rep.getRepresentativeKind().value() == 'Association') {
                    def name = rep.getName();
                    name.setOrganizationName(name.getLastName());
                    rep.setName(name);
                }
            -->
        </g:script>
    </g:groovy>

</smooks-resource-list>
