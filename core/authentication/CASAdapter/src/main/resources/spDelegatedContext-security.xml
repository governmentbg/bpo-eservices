<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"  
	xmlns:sec="http://www.springframework.org/schema/security"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
				        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd
                        http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-3.2.xsd">


	<!-- AUTHENTICATION CONFIGURATION -->
	<sec:authentication-manager alias="spAuthenticationManager">
		<sec:authentication-provider ref="spDelegateAuthenticationProvider" />
	</sec:authentication-manager>

	<bean id="spDelegateAuthenticationProvider"
		class="org.springframework.security.cas.authentication.CasAuthenticationProvider">
		<property name="authenticationUserDetailsService" ref="spDelegateAuthenticationUserDetailsService" />
		<property name="serviceProperties" ref="serviceProperties" />
		<property name="ticketValidator">
			<bean
				class="org.jasig.cas.client.validation.Cas20ServiceTicketValidator">
				<constructor-arg index="0" value="${cas.adapter.server}" />
			</bean>
		</property>
		<property name="key" value="${cas.adapter.key}" />
	</bean>

	<bean id="spDelegateAuthenticationEntryPoint"
		class="eu.ohim.sp.integration.adapter.cas.authorisation.service.ATCasAuthenticationEntryPoint">
		<property name="loginUrl" value="${cas.adapter.login.url}" />
		<property name="serviceProperties" ref="serviceProperties" />
	</bean>


	<!-- FILTERS CONFIGURATION -->
	<bean id="spDelegateAuthenticationFilter"
		class="org.springframework.security.cas.web.CasAuthenticationFilter">
		<property name="authenticationManager" ref="spAuthenticationManager" />
	</bean>

	<bean id="spDelegateSingleSignOutFilter"
		class="eu.ohim.sp.integration.adapter.cas.authentication.filter.SPDelegateSingleSignOutFilter" />

	<bean id="spDelegateSingleSignOutHttpSessionListener"
		class="org.jasig.cas.client.session.SingleSignOutHttpSessionListener" />


	<!-- HANDLER CONFIGURATION -->
	<bean id="spDelegateLogoutHandler"
		class="org.springframework.security.web.authentication.logout.SecurityContextLogoutHandler" />

	<bean id="spDelegateLogoutSuccessHandler"
		class="org.springframework.security.web.authentication.logout.SimpleUrlLogoutSuccessHandler">
		<property name="defaultTargetUrl" value="${cas.adapter.logout.url}?service=${cas.adapter.application.logout.page}"/>
	</bean>

	<bean id="spDelegateAccessDeniedHandler"
		class="org.springframework.security.web.access.AccessDeniedHandlerImpl" />


	<!-- AUTHORISATION CONFIGURATION -->
    <bean id="spDelegateAuthenticationUserDetailsService"
          class="eu.ohim.sp.integration.adapter.cas.authorisation.service.LiferayUserService" />

    <!-- CUSTOM CONFIGURATION -->
	<bean id="casDelegateSingleSignOutFilter"
		class="org.jasig.cas.client.session.SingleSignOutFilter" />

	<bean id="serviceProperties"
		class="org.springframework.security.cas.ServiceProperties">
		<property name="service" value="${cas.adapter.service}" />
		<property name="sendRenew" value="false" />
	</bean>

	<!--<context:property-placeholder location="classpath:cas.properties" />-->
	<!-- Could be loaded from external location, i.e. -->
	<!-- 	file:${catalina.home}/conf/cas.properties -->

</beans>